-- Use your existing database
USE payrollmanagementsystem_db;

-- Check if employees table exists, if not create it
IF OBJECT_ID('employees', 'U') IS NULL
BEGIN
    CREATE TABLE employees (
        employee_id INT IDENTITY(1,1) PRIMARY KEY,
        name VARCHAR(255) NOT NULL,
        classification VARCHAR(100) NOT NULL,
        base_salary DECIMAL(10, 2) NOT NULL,
        department VARCHAR(100) NOT NULL,
        leave_credits_vacation INT DEFAULT 5,
        leave_credits_sick INT DEFAULT 5,
        created_at DATETIME DEFAULT GETDATE()
    );
END;

-- Check if leave_requests table exists, if not create it
IF OBJECT_ID('leave_requests', 'U') IS NULL
BEGIN
    CREATE TABLE leave_requests (
        leave_id INT IDENTITY(1,1) PRIMARY KEY,
        employee_id INT NOT NULL,
        leave_type VARCHAR(100) NOT NULL,
        start_date DATE NOT NULL,
        end_date DATE NOT NULL,
        reason TEXT NOT NULL,
        status VARCHAR(50) DEFAULT 'Pending Approval',
        created_at DATETIME DEFAULT GETDATE(),
        FOREIGN KEY (employee_id) REFERENCES employees(employee_id) ON DELETE CASCADE
    );
END;

-- Check if shifts table exists, if not create it
IF OBJECT_ID('shifts', 'U') IS NULL
BEGIN
    CREATE TABLE shifts (
        shift_id INT IDENTITY(1,1) PRIMARY KEY,
        employee_id INT NOT NULL,
        shift_start DATETIME NOT NULL,
        shift_end DATETIME NOT NULL,
        shift_type VARCHAR(50) NOT NULL,
        duration DECIMAL(5, 2) NOT NULL,
        created_at DATETIME DEFAULT GETDATE(),
        FOREIGN KEY (employee_id) REFERENCES employees(employee_id) ON DELETE CASCADE
    );
END;

-- Check if payroll table exists, if not create it
IF OBJECT_ID('payroll', 'U') IS NULL
BEGIN
    CREATE TABLE payroll (
        payroll_id INT IDENTITY(1,1) PRIMARY KEY,
        employee_id INT NOT NULL,
        pay_period VARCHAR(50) NOT NULL,
        total_pay DECIMAL(10, 2) NOT NULL,
        net_pay DECIMAL(10, 2) NOT NULL,
        overtime_pay DECIMAL(10, 2) NOT NULL,
        contributions DECIMAL(10, 2) NOT NULL,
        created_at DATETIME DEFAULT GETDATE(),
        FOREIGN KEY (employee_id) REFERENCES employees(employee_id) ON DELETE CASCADE
    );
END;

-- Check if contributions table exists, if not create it
IF OBJECT_ID('contributions', 'U') IS NULL
BEGIN
    CREATE TABLE contributions (
        contribution_id INT IDENTITY(1,1) PRIMARY KEY,
        employee_id INT NOT NULL,
        sss_employee DECIMAL(10, 2) NOT NULL,
        sss_employer DECIMAL(10, 2) NOT NULL,
        philhealth_employee DECIMAL(10, 2) NOT NULL,
        philhealth_employer DECIMAL(10, 2) NOT NULL,
        pagibig_employee DECIMAL(10, 2) NOT NULL,
        pagibig_employer DECIMAL(10, 2) NOT NULL,
        created_at DATETIME DEFAULT GETDATE(),
        FOREIGN KEY (employee_id) REFERENCES employees(employee_id) ON DELETE CASCADE
    );
END;
